<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseball Performance Analysis Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="root"></div>
    <script>
        const { useState, useRef, useEffect } = React;

        // Simple icon components
        const Upload = () => React.createElement('svg', { 
            className: "w-12 h-12", 
            fill: "none", 
            stroke: "currentColor", 
            viewBox: "0 0 24 24" 
        }, React.createElement('path', { 
            strokeLinecap: "round", 
            strokeLinejoin: "round", 
            strokeWidth: 2, 
            d: "M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" 
        }));

        const Download = () => React.createElement('svg', { 
            className: "w-5 h-5", 
            fill: "none", 
            stroke: "currentColor", 
            viewBox: "0 0 24 24" 
        }, React.createElement('path', { 
            strokeLinecap: "round", 
            strokeLinejoin: "round", 
            strokeWidth: 2, 
            d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" 
        }));

        const FileText = () => React.createElement('svg', { 
            className: "w-6 h-6", 
            fill: "none", 
            stroke: "currentColor", 
            viewBox: "0 0 24 24" 
        }, React.createElement('path', { 
            strokeLinecap: "round", 
            strokeLinejoin: "round", 
            strokeWidth: 2, 
            d: "M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" 
        }));

        const Target = () => React.createElement('svg', { 
            className: "w-8 h-8", 
            fill: "none", 
            stroke: "currentColor", 
            viewBox: "0 0 24 24" 
        }, React.createElement('circle', { cx: "12", cy: "12", r: "10", strokeWidth: 2 }),
           React.createElement('circle', { cx: "12", cy: "12", r: "6", strokeWidth: 2 }),
           React.createElement('circle', { cx: "12", cy: "12", r: "2", strokeWidth: 2 }));

        const BaseballAnalyzer = () => {
          const [csvData, setCsvData] = useState(null);
          const [selectedPlayer, setSelectedPlayer] = useState('');
          const [playerData, setPlayerData] = useState(null);
          const [chartType, setChartType] = useState('bar');
          const [recommendations, setRecommendations] = useState({
            kmotion: '',
            forceplate: '',
            swing: '',
            movement: [{ test: '', findings: '' }]
          });
          const fileInputRef = useRef(null);
          const chartRef1 = useRef(null);
          const chartRef2 = useRef(null);
          const chart1Instance = useRef(null);
          const chart2Instance = useRef(null);

          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (file && file.type === 'text/csv') {
              const reader = new FileReader();
              reader.onload = (e) => {
                const text = e.target.result;
                const rows = text.split('\n');
                const headers = rows[0].split(',').map(h => h.trim());
                
                const data = rows.slice(1).filter(row => row.trim()).map(row => {
                  const values = row.split(',').map(v => v.trim());
                  const obj = {};
                  headers.forEach((header, index) => {
                    obj[header] = values[index];
                  });
                  return obj;
                });
                
                setCsvData(data);
                if (data.length > 0) {
                  setSelectedPlayer(data[0]['First Name'] + ' ' + data[0]['Last Name']);
                }
              };
              reader.readAsText(file);
            }
          };

          const processPlayerData = (playerName) => {
            if (!csvData) return null;
            
            const player = csvData.find(p => (p['First Name'] + ' ' + p['Last Name']) === playerName);
            if (!player) return null;

            const swings = [];
            const metrics = ['Exit Velo', 'Bat Speed', 'Rot. Acc.', 'VBA', 'Attack Angle', 'On Plane Efficiency'];
            
            for (let i = 1; i <= 5; i++) {
              const swing = {};
              metrics.forEach(metric => {
                const value = player[`${metric} ${i}`];
                if (value && value !== '') {
                  swing[metric] = parseFloat(value) || value;
                }
              });
              if (Object.keys(swing).length > 0) {
                swing.swing = i;
                swings.push(swing);
              }
            }

            const averages = {};
            metrics.forEach(metric => {
              const values = swings.map(s => s[metric]).filter(v => v !== undefined && !isNaN(v));
              if (values.length > 0) {
                averages[metric] = values.reduce((a, b) => a + b, 0) / values.length;
              }
            });

            return { name: playerName, swings, averages, rawData: player };
          };

          const createDistributionData = (metric) => {
            if (!playerData || !playerData.swings) return [];
            
            const values = playerData.swings.map(s => s[metric]).filter(v => v !== undefined && !isNaN(v));
            if (values.length === 0) return [];

            const min = Math.min(...values);
            const max = Math.max(...values);
            const range = max - min;
            const bins = Math.min(5, values.length); // Fewer bins for small datasets
            const binSize = range / bins;

            const distribution = [];
            for (let i = 0; i < bins; i++) {
              const binStart = min + i * binSize;
              const binEnd = min + (i + 1) * binSize;
              const count = values.filter(v => v >= binStart && v < binEnd).length;
              distribution.push({
                label: `${binStart.toFixed(1)}-${binEnd.toFixed(1)}`,
                count,
                density: count / values.length
              });
            }

            return distribution;
          };

          const createChart = (canvasRef, data, title, color, chartInstance) => {
            if (!data || data.length === 0 || !canvasRef.current) return;

            // Destroy existing chart
            if (chartInstance.current) {
              chartInstance.current.destroy();
            }

            const ctx = canvasRef.current.getContext('2d');
            
            const chartConfig = {
              type: chartType === 'line' ? 'line' : 'bar',
              data: {
                labels: data.map(d => d.label),
                datasets: [{
                  label: 'Density',
                  data: data.map(d => d.density),
                  backgroundColor: chartType === 'line' ? 'transparent' : color + '80',
                  borderColor: color,
                  borderWidth: 2,
                  fill: chartType === 'line'
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  title: {
                    display: true,
                    text: title
                  },
                  legend: {
                    display: false
                  }
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    title: {
                      display: true,
                      text: 'Density'
                    }
                  },
                  x: {
                    title: {
                      display: true,
                      text: title
                    }
                  }
                }
              }
            };

            chartInstance.current = new Chart(ctx, chartConfig);
          };

          useEffect(() => {
            if (selectedPlayer) {
              const data = processPlayerData(selectedPlayer);
              setPlayerData(data);
            }
          }, [selectedPlayer, csvData]);

          useEffect(() => {
            if (playerData) {
              const batSpeedData = createDistributionData('Bat Speed');
              const rotAccData = createDistributionData('Rot. Acc.');
              
              setTimeout(() => {
                createChart(chartRef1, batSpeedData, 'Bat Speed Distribution', '#3B82F6', chart1Instance);
                createChart(chartRef2, rotAccData, 'Rotational Acceleration Distribution', '#EF4444', chart2Instance);
              }, 100);
            }
          }, [playerData, chartType]);

          const getPlayerList = () => {
            if (!csvData) return [];
            return csvData.map(p => p['First Name'] + ' ' + p['Last Name']).filter(Boolean);
          };

          const generateReport = () => {
            if (!playerData) return;

            const reportContent = `# ${playerData.name} - Performance Analysis & Recommendations

## Performance Metrics
- Exit Velocity: ${playerData.averages['Exit Velo']?.toFixed(1) || 'N/A'} mph
- Bat Speed: ${playerData.averages['Bat Speed']?.toFixed(1) || 'N/A'} mph
- Rotational Acceleration: ${playerData.averages['Rot. Acc.']?.toFixed(1) || 'N/A'} deg/s²
- VBA: ${playerData.averages['VBA']?.toFixed(1) || 'N/A'}°
- Attack Angle: ${playerData.averages['Attack Angle']?.toFixed(1) || 'N/A'}°
- On Plane Efficiency: ${playerData.averages['On Plane Efficiency']?.toFixed(1) || 'N/A'}%

## K-Motion Analysis
${recommendations.kmotion}

## Force Plate Analysis
${recommendations.forceplate}

## Swing Recommendations
${recommendations.swing}

## Movement Screen Assessment
${recommendations.movement.filter(item => item.test).map(item => `**${item.test}**: ${item.findings}`).join('\n')}`;

            const blob = new Blob([reportContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${playerData.name}_Performance_Report.md`;
            a.click();
            URL.revokeObjectURL(url);
          };

          return React.createElement('div', { className: "max-w-6xl mx-auto p-6 bg-white min-h-screen" },
            
            // Header
            React.createElement('div', { className: "mb-8" },
              React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-2 flex items-center gap-2" },
                React.createElement(Target, { className: "text-blue-600" }),
                "Baseball Performance Analysis Tool"
              ),
              React.createElement('p', { className: "text-gray-600" }, "Upload CSV data and create professional performance reports")
            ),

            // File Upload
            React.createElement('div', { className: "mb-8 p-6 border-2 border-dashed border-gray-300 rounded-lg" },
              React.createElement('div', { className: "text-center" },
                React.createElement(Upload, { className: "text-gray-400 mx-auto mb-4" }),
                React.createElement('h3', { className: "text-lg font-semibold mb-2" }, "Upload CSV Data"),
                React.createElement('p', { className: "text-gray-600 mb-4" }, "Upload your baseball performance CSV file"),
                React.createElement('input', {
                  type: "file",
                  accept: ".csv",
                  onChange: handleFileUpload,
                  ref: fileInputRef,
                  className: "hidden"
                }),
                React.createElement('button', {
                  onClick: () => fileInputRef.current?.click(),
                  className: "bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                }, "Choose File"),
                csvData && React.createElement('p', { className: "text-green-600 mt-2" }, `✓ CSV loaded with ${csvData.length} players`)
              )
            ),

            csvData && React.createElement(React.Fragment, null,
              
              // Player Selection
              React.createElement('div', { className: "mb-6" },
                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Select Player"),
                React.createElement('select', {
                  value: selectedPlayer,
                  onChange: (e) => setSelectedPlayer(e.target.value),
                  className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                }, getPlayerList().map(player => 
                  React.createElement('option', { key: player, value: player }, player)
                ))
              ),

              // Chart Type Selection
              React.createElement('div', { className: "mb-6" },
                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Chart Type"),
                React.createElement('div', { className: "flex gap-4" },
                  ['bar', 'line'].map(type =>
                    React.createElement('button', {
                      key: type,
                      onClick: () => setChartType(type),
                      className: `px-4 py-2 rounded-lg ${chartType === type ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`
                    }, type.charAt(0).toUpperCase() + type.slice(1) + ' Chart')
                  )
                )
              ),

              playerData && React.createElement(React.Fragment, null,
                
                // Performance Analysis
                React.createElement('div', { className: "mb-8" },
                  React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4" }, `${playerData.name} - Performance Analysis`),
                  
                  // Charts
                  React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" },
                    React.createElement('div', { className: "bg-gray-50 p-4 rounded-lg" },
                      React.createElement('div', { style: { height: '300px' } },
                        React.createElement('canvas', { ref: chartRef1 })
                      )
                    ),
                    React.createElement('div', { className: "bg-gray-50 p-4 rounded-lg" },
                      React.createElement('div', { style: { height: '300px' } },
                        React.createElement('canvas', { ref: chartRef2 })
                      )
                    )
                  ),

                  // Metrics Table
                  React.createElement('div', { className: "bg-white border rounded-lg overflow-hidden mb-8" },
                    React.createElement('table', { className: "w-full" },
                      React.createElement('thead', { className: "bg-green-600 text-white" },
                        React.createElement('tr', null,
                          React.createElement('th', { className: "px-6 py-3 text-left font-semibold" }, "Metric"),
                          React.createElement('th', { className: "px-6 py-3 text-left font-semibold" }, "Player Avg"),
                          React.createElement('th', { className: "px-6 py-3 text-left font-semibold" }, "Notes")
                        )
                      ),
                      React.createElement('tbody', null,
                        [
                          { metric: 'Exit Velocity', key: 'Exit Velo', unit: 'mph', color: 'green' },
                          { metric: 'Bat Speed', key: 'Bat Speed', unit: 'mph', color: 'red' },
                          { metric: 'Rotational Acceleration', key: 'Rot. Acc.', unit: 'deg/s²', color: 'red' },
                          { metric: 'VBA', key: 'VBA', unit: 'degrees', color: 'red' },
                          { metric: 'Attack Angle', key: 'Attack Angle', unit: 'degrees', color: 'green' },
                          { metric: 'On Plane Efficiency', key: 'On Plane Efficiency', unit: 'percentage', color: 'green' }
                        ].map(item =>
                          React.createElement('tr', { key: item.key, className: `border-b bg-${item.color}-50` },
                            React.createElement('td', { className: "px-6 py-3 font-medium" }, item.metric),
                            React.createElement('td', { className: "px-6 py-3" }, 
                              `${playerData.averages[item.key]?.toFixed(1) || 'N/A'}${item.key === 'On Plane Efficiency' ? '%' : ''}`
                            ),
                            React.createElement('td', { className: "px-6 py-3 text-sm text-gray-600" }, item.unit)
                          )
                        )
                      )
                    )
                  )
                ),

                // Recommendations
                React.createElement('div', { className: "mb-8" },
                  React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2" },
                    React.createElement(FileText, null),
                    "Analysis & Recommendations"
                  ),
                  
                  React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                    ['kmotion', 'forceplate'].map(type =>
                      React.createElement('div', { key: type },
                        React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, 
                          type === 'kmotion' ? 'K-Motion Analysis' : 'Force Plate Analysis'
                        ),
                        React.createElement('textarea', {
                          value: recommendations[type],
                          onChange: (e) => setRecommendations(prev => ({ ...prev, [type]: e.target.value })),
                          className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                          rows: "4",
                          placeholder: `Enter ${type === 'kmotion' ? 'K-Motion' : 'Force Plate'} analysis findings...`
                        })
                      )
                    ),
                    
                    React.createElement('div', { className: "md:col-span-2" },
                      React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Swing Recommendations"),
                      React.createElement('textarea', {
                        value: recommendations.swing,
                        onChange: (e) => setRecommendations(prev => ({ ...prev, swing: e.target.value })),
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                        rows: "4",
                        placeholder: "Enter swing recommendations..."
                      })
                    )
                  )
                ),

                // Movement Screen
                React.createElement('div', { className: "mb-8" },
                  React.createElement('h3', { className: "text-xl font-semibold text-gray-800 mb-4 flex items-center justify-between" },
                    "Movement Screen Assessment",
                    React.createElement('button', {
                      onClick: () => setRecommendations(prev => ({
                        ...prev,
                        movement: [...prev.movement, { test: '', findings: '' }]
                      })),
                      className: "bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors"
                    }, "Add Test")
                  ),
                  React.createElement('div', { className: "space-y-4" },
                    recommendations.movement.map((item, index) =>
                      React.createElement('div', { key: index, className: "flex items-start gap-4 p-4 border border-gray-200 rounded-lg" },
                        React.createElement('input', {
                          type: "text",
                          value: item.test,
                          onChange: (e) => {
                            const newMovement = [...recommendations.movement];
                            newMovement[index].test = e.target.value;
                            setRecommendations(prev => ({ ...prev, movement: newMovement }));
                          },
                          className: "w-48 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                          placeholder: "Test name (e.g., Pelvic Tilt)"
                        }),
                        React.createElement('textarea', {
                          value: item.findings,
                          onChange: (e) => {
                            const newMovement = [...recommendations.movement];
                            newMovement[index].findings = e.target.value;
                            setRecommendations(prev => ({ ...prev, movement: newMovement }));
                          },
                          className: "flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                          rows: "2",
                          placeholder: "Enter findings for this test..."
                        }),
                        recommendations.movement.length > 1 && React.createElement('button', {
                          onClick: () => {
                            const newMovement = recommendations.movement.filter((_, i) => i !== index);
                            setRecommendations(prev => ({ ...prev, movement: newMovement }));
                          },
                          className: "bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600 transition-colors text-sm"
                        }, "Remove")
                      )
                    )
                  )
                ),

                // Generate Report
                React.createElement('div', { className: "text-center" },
                  React.createElement('button', {
                    onClick: generateReport,
                    className: "bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 mx-auto"
                  },
                    React.createElement(Download, null),
                    "Generate Report"
                  )
                )
              )
            )
          );
        };

        ReactDOM.render(React.createElement(BaseballAnalyzer), document.getElementById('root'));
    </script>
</body>
</html>
